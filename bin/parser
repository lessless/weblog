#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../lib/cli'
require_relative '../lib/parser'
require_relative '../lib/parser/log_file_reader'
require_relative '../lib/parser/log_entry'
require_relative '../lib/parser/stats_repository'
require_relative '../lib/parser/ip_address'
require_relative '../lib/parser/printer'
require_relative '../lib/parser/visits'
require_relative '../lib/parser/views'

opts = CLI.parse(ARGV)

if opts.file.nil?
  CLI.parse(['-h'])
else
  reader = Parser::LogFileReader.new(opts.file)
  repository = Parser::StatsRepository.new
  printer = Parser::Printer.new
  parser = Parser.new(reader: reader, repository: repository, printer: printer)
  parser.run
end
